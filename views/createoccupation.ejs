<html lang="en" class="perfect-scrollbar-on"><head>
    <meta charset="utf-8">
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="../assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>
     Manage Folder
    </title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no" name="viewport">
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <!-- CSS Files -->
    <link href="../../../assets2/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../assets2/css/now-ui-dashboard.css?v=1.5.0" rel="stylesheet">
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="../../../assets2/demo/demo.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/perfect-scrollbar@1.5.0/css/perfect-scrollbar.min.css">
    <script src="https://cdn.jsdelivr.net/npm/perfect-scrollbar@1.5.0/dist/perfect-scrollbar.jquery.min.js"></script>
  
    <!-- DataTables CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
  
  <!-- DataTables jQuery -->
  
  
    <style>
       
  
        .folder-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
  
        .folder-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
  
        .folder-icon {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
  
        .folder-meta {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 0.9rem;
            margin-top: 1rem;
        }
  
        .add-button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
  
        @media (max-width: 600px) {
          
        
        }
    </style>
  <body class="">
    <div class="wrapper ">
      <%- include ('./partials/sidebar') %>
      <div class="main-panel ps" id="main-panel" style="min-height: 300px; overflow: hidden;">
        <!-- Navbar -->
        <%- include ('./partials/top') %>
        <!-- End Navbar -->
        <div class="panel-header panel-header-sm">
        </div>
        <div class="content " id="container" >
            <div class="row">
              
            </div>
            <div class="row">
                <div class="col-md-12">
                  <div class="card">
                    <div class="card-header">
                        <div class="card-header">
                            <h4 class="card-title">
                                <span id="breadcrumb">Create Occupation</span>
                            </h4>
                        </div>
                    </div>
                    <div class="card-body">
                  
                      <%- include ('./partials/messages') %>
                        <div class="table-responsive" >
                          <table class="table" id="fileTable">
                            <thead class="text-primary">
                              <tr>
                                <th>Occupation Name</th>
                           
                                <th>Created Date</th>
                                <th>Action</th>
                            
                              </tr>
                            </thead>
                            <tbody>
                              <% occlist.forEach(function(file) { %>
                                <tr>
                                  <td><%= file.occupationname %></td>
                                   <td><%= new Date(file.createdAt).toLocaleDateString() %> G.C</td>
                                    <td>
                                      <a href="#" class="btn btn-primary btn-sm" 
                                      data-toggle="modal" 
                                      data-target="#updateFolderModal"
                                      data-id="<%= file.id %>" 
                                      data-name="<%= file.name %>">
                                     Update
                                   </a>
                                  </td>
                                
                                </tr>
                              <% }); %>
                            </tbody>
                          </table>
                          
                           
                        </div>
                    
                        <button class="add-button"  id="addfolder" >
                            <i class="now-ui-icons ui-1_simple-add"></i>
                            
                        </button>
                       
                    
                       
                    </div>
                  </div>
                </div>
              
              </div>
        </div>
  
        <%- include ('./partials/footer') %>
      </div>
    <!--   Core JS Files   -->
    <div class="modal fade" id="addFolderModal" tabindex="-1" role="dialog" aria-labelledby="addFolderModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addFolderModalLabel">Add New Occupation</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="addFolderForm">
                 <div class="form-group">
                <label for="folderName">Department Name</label>
                <select class="form-control mb-2" id="departmentname" name="departmentname">
                 <option value="">Select Department</option>
                  <% deptnames.forEach(function(department) { %>
                    <option value="<%= department.id %>"><%= department.name %></option>
                  <% }); %>
                </select>
              </div>
              <div class="form-group">
                <label for="folderName">Occupation Name</label>
                <input type="text" class="form-control mb-2" id="occupationname" name="occupationname" placeholder="Enter Occupation Name">
              
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="createFolderBtn">Create Occupation</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal fade" id="updateFolderModal" tabindex="-1" role="dialog" aria-labelledby="addFolderModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addFolderModalLabel">Update Department</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="addFolderForm">
              <div class="form-group">
                <label for="folderName">Occupation Name</label>
                <input type="text" class="form-control mb-2" id="occupationameu" name="occupationameu" placeholder="Enter Occupation Name">
              
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="updateDeptBtn">Update Occupation</button>
          </div>
        </div>
      </div>
    </div>
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script src="../../assets2/js/core/jquery.min.js"></script>
  
    <script src="../../assets2/js/core/popper.min.js"></script>
    <script src="../../assets2/js/core/bootstrap.min.js"></script>
    <!--  Google Maps Plugin    -->
    <!-- Chart JS -->
    <!--  Notifications Plugin    -->
    <script src="../../assets2/js/plugins/bootstrap-notify.js"></script>
    <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="../../assets2/js/now-ui-dashboard.min.js?v=1.5.0" type="text/javascript"></script><!-- Now Ui Dashboard DEMO methods, don't include it in your project! -->
    <script src="../../assets2/demo/demo.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
  
    <script>
      $(document).ready(function() {
         
          $("#addfolder").click(function(e) {
          e.preventDefault();
          $("#addFolderModal").modal('show');
        });
     
        $("#uploadBtn").click(function() {
            uploadFiles();
             $("#uploadFileModal").modal('hide');
        });
           
    
    
        $("#createFolderBtn").click(function() {
                // folder creation logic here
                createFolder();
                $("#addFolderModal").modal('hide');
            });
    
      });
    
     
      $('#updateFolderModal').on('show.bs.modal', function (event) {
  // Get the button that triggered the modal
  var button = $(event.relatedTarget); 

  // Extract the department ID and name from the data-* attributes
  var departmentId = button.data('id');
  var departmentName = button.data('name');
  
  // Update the modal's content
  var modal = $(this);
  modal.find('#departmentnameu').val(departmentName);  // Set the department name in the input field
  modal.find('#updateDeptBtn').data('id', departmentId);  // Store the department id in the "Create" button
});

  
  </script>
  
  <script>
    $('#updateDeptBtn').click(function() {
  // Get the department id and new name from the modal
  var departmentId = $(this).data('id');
  var departmentName = $('#departmentnameu').val();

  // Validate the department name
  if (departmentName.trim() === '') {
    alert('Department name cannot be empty');
    return;
  }

  // Make the AJAX POST request to update the department
  $.ajax({
    url: '/selamcdms/updateoccupation',  // The URL where the server will handle the update
    type: 'POST',
    data: {
      id: departmentId,
      name: departmentName
    },
    success: function(response) {
      // Handle the response from the server
      if (response.success) {
        // Close the modal
        $('#addFolderModal').modal('hide');
        
        // Optionally, update the table with the new department name (client-side)
        // This depends on your response structure and logic
        // Example: Update the table row
        $('tr').each(function() {
          if ($(this).find('.btn').data('id') == departmentId) {
            $(this).find('td:first').text(departmentName);  // Update the department name in the table
          }
        });
        location.reload();
      } else {
        alert('Failed to update department');
      }
    },
    error: function() {
      alert('An error occurred while updating the department');
    }
  });
});

  </script>
    <script>
  
  async function createFolder() {
     
      var occupationname= $("#occupationname").val();  
   var departmentname= $("#departmentname").val();  
      if (!occupationname) {
          alert("Please enter a occupation.");
          return;
      }

      try {
          const response = await $.ajax({
              url: '/selamcdms/addnewoccupation',
              type: 'POST',
              contentType: 'application/json',
              data: JSON.stringify({ occupationame:occupationname,departmentname:departmentname}),
          });
           location.reload();
         
      } catch (error) {
          console.error('Error creating folder:', error);
          alert('Error creating occupation. See console for details.');
      }
  }
  
  
  </script>
  <script>
   
  $(document).ready(function() {
  $('#fileTable').DataTable({
                  "pageLength": 10,   // Set the default page length to 10 items
                  "searching": true,  // Enable search functionality
                  "paging": true,     // Enable paging functionality
                  "ordering": true,   // Enable sorting
                  "info": true        // Display info about the table
              });
        const container = document.querySelector('#container');
        new PerfectScrollbar(container, {
            suppressScrollX: true, // Disable horizontal scroll
            useBothWheelAxes: true, // Allow scrolling with both axes (vertical & horizontal)
            wheelSpeed: 1, // Speed of scrolling
            wheelPropagation: true, // Allow scrolling to propagate outside the element
        });
    });
  </script>
  
  
  </body></html>